---
import Layout from '../layouts/Layout.astro';
import { fetchOne, fetchAll } from '../lib/sanity';

const techPage = await fetchOne('technologyPage');
const agents = await fetchAll('agent');
const partners = await fetchAll('technologyPartner');

const partnerLogoMap: Record<string, string> = {
  'Anthropic': '/images/logos/anthropic.png',
  'OpenAI': '/images/logos/openai.svg',
  'AWS Bedrock Guardrails': '/images/logos/guardrails.png',
};

const partnerLogoClass: Record<string, string> = {
  'OpenAI': 'max-h-36 max-w-36 object-contain scale-150',
  'default': 'max-h-36 max-w-36 object-contain',
};

const aiCapabilities = techPage.aiCapabilities || [];
---

<Layout title="Technology | pensionable.ai" description="Discover the technology behind pensionable.ai. Our AI agent fleet, automated reasoning capabilities, and technology partnerships.">
  <!-- Overview Section -->
  <section class="hero-section bg-gradient-brand-soft">
    <div class="container">
      <div class="max-w-3xl mx-auto text-center">
        <h1 class="text-4xl md:text-5xl font-bold mb-6">{techPage.heroTitle}</h1>
        <p class="text-xl text-grey">{techPage.heroSubtitle}</p>
      </div>
    </div>
  </section>

  <!-- Our Approach -->
  <section class="section">
    <div class="relative">
      <div id="approach" class="absolute" style="top: -120px;"></div>
      <div class="container">
        <div class="max-w-3xl mx-auto">
          <h2 class="text-3xl font-bold text-center mb-8">{techPage.approachTitle}</h2>
          <div class="prose max-w-none text-grey">
            {techPage.approachContent?.split('\n\n').map((para: string, i: number) => (
              <p class={i < (techPage.approachContent?.split('\n\n').length - 1) ? 'mb-4' : ''}>{para}</p>
            ))}
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Agent Fleet -->
  <section class="section bg-gradient-light">
    <div class="relative">
      <div id="agent-fleet" class="absolute" style="top: -120px;"></div>
      <div class="container">
        <h2 class="text-3xl font-bold text-center mb-12">Agent Fleet</h2>
        <div class="space-y-16">
          {agents.map((agent: any) => (
            <div class="flex flex-col md:flex-row gap-8">
              <div class="md:w-1/2 card">
                <div class="mb-8">
                  <h3 class="text-2xl font-bold mb-4">{agent.name}</h3>
                  <p class="text-grey mb-6">{agent.description}</p>
                </div>
                <div>
                  <h4 class="text-xl font-bold mb-4">Key Capabilities</h4>
                  <ul class="space-y-3">
                    {agent.capabilities?.map((capability: string) => (
                      <li class="flex items-start">
                        <span class="text-purple mr-3">&bull;</span>
                        <p class="text-grey">{capability}</p>
                      </li>
                    ))}
                  </ul>
                </div>
              </div>
              <div class="md:w-1/2 flex items-center justify-center rounded-lg overflow-hidden">
                <img
                  src={`/images/diagrams/${agent.slug?.current || agent.abbreviation?.toLowerCase()}-diagram.png`}
                  alt={`${agent.name} architecture diagram`}
                  class="w-full h-full object-cover rounded-lg"
                  width="600"
                  height="400"
                  loading="lazy"
                />
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  </section>

  <!-- AI Capabilities -->
  <section class="section">
    <div class="relative">
      <div id="ai-capabilities" class="absolute" style="top: -120px;"></div>
      <div class="container">
        <h2 class="text-3xl font-bold text-center mb-12">AI Capabilities</h2>
        <div class="grid md:grid-cols-2 gap-8">
          {aiCapabilities.map((capability: any) => (
            <div class="card">
              <h3 class="text-2xl font-bold mb-4">{capability.title}</h3>
              <p class="text-grey mb-6">{capability.description}</p>
              <ul class="space-y-3">
                {capability.items?.map((item: any) => (
                  <li class="flex items-start">
                    <span class="text-purple mr-3">&bull;</span>
                    <p class="text-grey">{item.title}</p>
                  </li>
                ))}
              </ul>
            </div>
          ))}
        </div>
      </div>
    </div>
  </section>

  <!-- Partners -->
  <section class="section bg-gradient-light">
    <div class="relative">
      <div id="partners" class="absolute" style="top: -120px;"></div>
      <div class="container">
        <h2 class="text-3xl font-bold text-center mb-12">Technology Partners</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          {partners.map((partner: any) => (
            <div class="flex flex-col bg-white rounded-lg shadow-card">
              <div class="p-8 flex items-center justify-center h-60">
                {partner.name === 'AWS Bedrock Guardrails' ? (
                  <a href={partner.url} target="_blank" rel="noopener noreferrer" class="bg-white flex items-center justify-center h-full w-full relative overflow-hidden" aria-label={`Visit ${partner.name} website`}>
                    <div class="w-36 h-36 relative overflow-hidden">
                      <img src={partnerLogoMap[partner.name]} alt={`${partner.name} Logo`} class="absolute top-1/2 left-1/2" style="transform: translate(-46%, -50%) scale(1.5);" width="144" height="144" loading="lazy" />
                    </div>
                  </a>
                ) : (
                  <a href={partner.url} target="_blank" rel="noopener noreferrer" class="bg-white flex items-center justify-center h-full w-full" aria-label={`Visit ${partner.name} website`}>
                    <img src={partnerLogoMap[partner.name]} alt={`${partner.name} Logo`} class={partnerLogoClass[partner.name] || partnerLogoClass['default']} width="144" height="144" loading="lazy" />
                  </a>
                )}
              </div>
              <div class="px-6 pb-6">
                <p class="text-grey text-sm">{partner.description}</p>
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  </section>

  <!-- Security & Compliance -->
  <section class="section">
    <div class="relative">
      <div id="security" class="absolute" style="top: -120px;"></div>
      <div class="container">
        <div class="max-w-3xl mx-auto">
          <h2 class="text-3xl font-bold text-center mb-8">Security & Compliance</h2>
          <div class="card">
            <p class="text-grey mb-6">{techPage.securityContent}</p>
            <div class="grid md:grid-cols-2 gap-6">
              <div>
                <h3 class="text-xl font-bold mb-4">Data Protection</h3>
                <ul class="space-y-3">
                  {techPage.dataProtectionItems?.map((item: string) => (
                    <li class="flex items-start"><span class="text-purple mr-3">&bull;</span><p class="text-grey">{item}</p></li>
                  ))}
                </ul>
              </div>
              <div>
                <h3 class="text-xl font-bold mb-4">Compliance</h3>
                <ul class="space-y-3">
                  {techPage.complianceItems?.map((item: string) => (
                    <li class="flex items-start"><span class="text-purple mr-3">&bull;</span><p class="text-grey">{item}</p></li>
                  ))}
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</Layout>
